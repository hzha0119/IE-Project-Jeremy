import requests
import pandas as pd

url1 = 'https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=GETLOCATION&keyword=GETKEYWORD&radius=5000&key=AIzaSyC0QRn5BcU84PAxi5A2BkqEriXUogZ0_tw'
url2 = 'https://maps.googleapis.com/maps/api/place/details/json?place_id=PUT_PLACE_ID&fields=geometry/location,name,formatted_address,formatted_phone_number&key=AIzaSyC0QRn5BcU84PAxi5A2BkqEriXUogZ0_tw'

file = 'Hospital_Locations.csv'
df = pd.read_csv(file)

def getPlaceID(test):
    loc_temp = str(test['Y']) + ',' + str(test['X'])
    name_temp = test['LabelName']
    url_temp = url1.replace('GETLOCATION', loc_temp).replace('GETKEYWORD', name_temp)
    r = requests.get(url_temp)
    return r.json()['results'][0]['place_id']


def getPlaceDetails(place_id):
    url_details = url2.replace('PUT_PLACE_ID', place_id)
    r = requests.get(url_details)
    return r.json()['result']


def getResult(result):
    a_dict = dict()
    a_dict["Address"] = result['formatted_address']
    a_dict["Phone"] = result['formatted_phone_number'].replace('(', '').replace(')', '')
    a_dict["General Practitioner (GP)"] = result['name']
    a_dict["Location"] = result['geometry']['location']
    return a_dict


hospital_list =[]
for i in range(df.shape[0]):
    test = dict(df.iloc[i,])
    try:
        xx = getResult(getPlaceDetails(getPlaceID(test)))
        hospital_list.append(str(xx).replace("'", '"'))
    except:
        pass
    print(len(hospital_list), end = '/')
    print(i + 1)



text = ','.join(hospital_list)
f = open('location3.json', 'w')
f.write('[' + text + ']')
f.close()